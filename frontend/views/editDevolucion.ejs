<!-- Encabezado tipo Dashboard -->
<div class="d-flex align-items-center justify-content-between mb-4">
  <div>
    <h1 class="h3 mb-1">Editar Devolución</h1>
    <p class="text-muted mb-0">Actualiza los datos de la devolución seleccionada</p>
  </div>
  <div>
    <a href="/verDevolucion" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Volver a la lista
    </a>
  </div>
</div>

<!-- Formulario -->
<div class="card shadow-sm">
  <div class="card-body">
    <form id="devolucionForm" action="/updateDevolucion" method="POST" novalidate>
      <input type="hidden" name="IdDev" value="<%= devolucion.IdDev %>">

      <div class="row g-3">
        <div class="col-12 col-md-6">
          <label for="IdVenta" class="form-label">Venta</label>
          <select name="IdVenta" id="IdVenta" class="form-select" required>
            <% if (ventas && ventas.length) { %>
              <% ventas.forEach(venta => { %>
                <option
                  value="<%= venta.IdVenta %>"
                  <%= String(venta.IdVenta) === String(devolucion.IdVenta) ? 'selected' : '' %>>
                  Venta #<%= venta.IdVenta %>
                </option>
              <% }) %>
            <% } else { %>
              <option value="" disabled selected>No hay ventas disponibles</option>
            <% } %>
          </select>
          <div class="invalid-feedback">Por favor selecciona una venta.</div>
        </div>

        <div class="col-12 col-md-6">
          <label for="IdProd" class="form-label">Producto</label>
          <select name="IdProd" id="IdProd" class="form-select" required>
            <% if (productos && productos.length) { %>
              <% productos.forEach(producto => { %>
                <option
                  value="<%= producto.IdProd %>"
                  <%= String(producto.IdProd) === String(devolucion.IdProd) ? 'selected' : '' %>>
                  <%= producto.Nombre %>
                </option>
              <% }) %>
            <% } else { %>
              <option value="" disabled selected>No hay productos disponibles</option>
            <% } %>
          </select>
          <div class="invalid-feedback">Por favor selecciona un producto.</div>
        </div>

        <div class="col-12 col-md-4">
          <label for="Cantidad" class="form-label">Cantidad</label>
          <input
            type="number"
            class="form-control"
            id="Cantidad"
            name="Cantidad"
            required
            min="1"
            step="1"
            value="<%= devolucion.Cantidad %>"
            placeholder="Ej. 1"
          />
          <div class="invalid-feedback">Ingresa una cantidad válida (entero positivo).</div>
        </div>

        <div class="col-12 col-md-8">
          <label for="Motivo" class="form-label">Motivo</label>
          <input
            type="text"
            class="form-control"
            id="Motivo"
            name="Motivo"
            required
            pattern="[A-Za-zÁÉÍÓÚáéíóúÑñ\s]+"
            minlength="3"
            maxlength="100"
            value="<%= devolucion.Motivo %>"
            placeholder="Ej. Producto defectuoso"
          />
          <div class="invalid-feedback">Ingresa un motivo válido (solo letras, mínimo 3 caracteres).</div>
        </div>

        <div class="col-12 col-md-4">
          <label for="Fecha" class="form-label">Fecha</label>
          <input
            type="date"
            class="form-control"
            id="Fecha"
            name="Fecha"
            required
            value="<%= devolucion.Fecha %>"
          />
          <div class="invalid-feedback">Ingresa una fecha válida.</div>
        </div>
      </div>

      <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary">
          <i class="bi bi-save me-1"></i> Actualizar
        </button>
        <a href="/verDevolucion" class="btn btn-secondary">Cancelar</a>
      </div>
    </form>
  </div>
</div>

<!-- Validación Bootstrap -->
<script>
  (function () {
    'use strict';
    const form = document.getElementById('devolucionForm');

    form.addEventListener('submit', function (event) {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  })();
</script>