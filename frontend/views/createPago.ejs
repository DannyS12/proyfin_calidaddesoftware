<!-- Encabezado tipo Dashboard -->
<div class="d-flex align-items-center justify-content-between mb-4">
  <div>
    <h1 class="h3 mb-1">Registrar Pago</h1>
    <p class="text-muted mb-0">Ingresa los detalles del pago correspondiente a una venta</p>
  </div>
  <div>
    <a href="/verPago" class="btn btn-outline-secondary">
      <i class="bi bi-arrow-left"></i> Volver a la lista
    </a>
  </div>
</div>

<!-- Formulario -->
<div class="card shadow-sm">
  <div class="card-body">
    <form id="pagoForm" action="/createPago" method="POST" novalidate>
      <div class="row g-3">
        <!-- Venta -->
        <div class="col-12 col-md-6">
          <label for="IdVenta" class="form-label">Venta Asociada</label>
          <select id="IdVenta" name="IdVenta" class="form-select" required>
            <option value="">Selecciona una venta</option>
            <% if (ventas && ventas.length > 0) { %>
              <% ventas.forEach(venta => { %>
                <option value="<%= venta.IdVenta %>">Venta #<%= venta.IdVenta %> — Total: Q <%= venta.Total %></option>
              <% }) %>
            <% } else { %>
              <option disabled>No hay ventas disponibles</option>
            <% } %>
          </select>
          <div class="invalid-feedback">Por favor selecciona una venta.</div>
        </div>

        <!-- Fecha -->
        <div class="col-12 col-md-6">
          <label for="Fecha" class="form-label">Fecha y Hora</label>
          <input type="datetime-local" id="Fecha" name="Fecha" class="form-control" required />
          <div class="invalid-feedback">Ingresa una fecha y hora válidas.</div>
        </div>

        <!-- Forma de Pago -->
        <div class="col-12 col-md-4">
          <label for="FormaPago" class="form-label">Forma de Pago</label>
          <select id="FormaPago" name="FormaPago" class="form-select" required>
            <option value="">Selecciona una forma de pago</option>
            <option value="Tarjeta">Tarjeta</option>
            <option value="Deposito">Depósito</option>
            <option value="Efectivo">Efectivo</option>
          </select>
          <div class="invalid-feedback">Selecciona una forma de pago.</div>
        </div>

        <!-- Monto -->
        <div class="col-12 col-md-4">
          <label for="Monto" class="form-label">Monto (Q)</label>
          <input
            type="text"
            id="Monto"
            name="Monto"
            class="form-control"
            required
            pattern="^\d+(\.\d{1,2})?$"
            placeholder="0.00"
          />
          <div class="invalid-feedback">Ingresa un monto válido (número positivo, hasta 2 decimales).</div>
        </div>

        <!-- Banco -->
        <div class="col-12 col-md-4">
          <label for="IdBanco" class="form-label">Banco</label>
          <select id="IdBanco" name="IdBanco" class="form-select">
            <option value="">Selecciona un banco</option>
            <% if (bancos && bancos.length > 0) { %>
              <% bancos.forEach(banco => { %>
                <option value="<%= banco.IdBanco %>"><%= banco.Nombre %></option>
              <% }) %>
            <% } else { %>
              <option disabled>No hay bancos registrados</option>
            <% } %>
          </select>
        </div>

        <!-- Número de referencia -->
        <div class="col-12 col-md-6">
          <label for="NumeroReferencia" class="form-label">Número de Referencia</label>
          <input
            type="text"
            id="NumeroReferencia"
            name="NumeroReferencia"
            class="form-control"
            maxlength="30"
            placeholder="Opcional"
          />
        </div>

        <!-- Usuario -->
        <div class="col-12 col-md-6">
          <label for="IdUsuario" class="form-label">Registrado por (Usuario)</label>
          <select id="IdUsuario" name="IdUsuario" class="form-select" required>
            <option value="">Selecciona un usuario</option>
            <% if (usuarios && usuarios.length > 0) { %>
              <% usuarios.forEach(usuario => { %>
                <option value="<%= usuario.IdUsuario %>"><%= usuario.NombreUsuario %></option>
              <% }) %>
            <% } else { %>
              <option disabled>No hay usuarios disponibles</option>
            <% } %>
          </select>
          <div class="invalid-feedback">Selecciona el usuario que registra el pago.</div>
        </div>
      </div>

      <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-success">
          <i class="bi bi-save me-1"></i> Guardar
        </button>
        <a href="/verPago" class="btn btn-secondary">Cancelar</a>
      </div>
    </form>
  </div>
</div>

<!-- Validación Bootstrap -->
<script>
  (function () {
    'use strict';
    const form = document.getElementById('pagoForm');
    const monto = document.getElementById('Monto');

    // Validación Bootstrap
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    });

    // Filtrar entrada: solo números y punto decimal
    monto.addEventListener('input', () => {
      monto.value = monto.value.replace(/[^0-9.]/g, '');
      // Prevenir más de un punto
      if ((monto.value.match(/\./g) || []).length > 1)
        monto.value = monto.value.replace(/\.+$/, '');
    });
  })();
</script>